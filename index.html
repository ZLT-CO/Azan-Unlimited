<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Azan Unlimited</title>

<link rel="icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
font-family:'Inter',sans-serif;
min-height:100vh;
color:white;
display:flex;
flex-direction:column;
align-items:center;
background:linear-gradient(-45deg,#0f1117,#1b2a1f,#16351f,#0e2d18);
background-size:400% 400%;
animation:gradient 15s ease infinite;
}

@keyframes gradient{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

header{
padding:25px;
font-size:1.8rem;
font-weight:700;
}

#countdown{
margin:15px 0;
font-size:1.1rem;
color:#81c784;
}

.prayer-container{
width:100%;
max-width:500px;
padding:10px;
}

.prayer{
display:flex;
justify-content:space-between;
align-items:center;
padding:18px;
margin:8px 0;
border-radius:16px;
background:rgba(255,255,255,0.08);
backdrop-filter:blur(10px);
transition:0.3s;
}

.prayer.active{
background:#00c853;
color:black;
box-shadow:0 0 25px #00c853;
}

.settings-btn{
position:fixed;
top:20px;
right:20px;
cursor:pointer;
font-size:1.2rem;
}

.modal{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.6);
display:none;
justify-content:center;
align-items:center;
}

.modal-content{
background:#121212;
padding:25px;
border-radius:15px;
width:90%;
max-width:400px;
}

select{
width:100%;
padding:8px;
margin-top:10px;
border-radius:8px;
border:none;
}

button{
margin-top:10px;
padding:8px 12px;
border:none;
border-radius:8px;
background:#00c853;
cursor:pointer;
}

footer{
margin-top:auto;
padding:20px;
font-size:0.8rem;
color:#aaa;
}
</style>
</head>
<body>

<div class="settings-btn" onclick="openSettings()">⚙️</div>
<header>Azan Unlimited</header>
<div id="countdown">Loading prayer times...</div>
<div class="prayer-container" id="prayerContainer"></div>
<footer>© 2026 ZLT Co.</footer>

<div class="modal" id="settingsModal">
<div class="modal-content">
<h3>Settings</h3>
<label>Reciter</label>
<select id="reciterSelect"></select>
<button onclick="previewAzan()">Preview Azan</button>
<button onclick="testAzan()">Test Notification</button>
<button onclick="closeSettings()">Close</button>
</div>
</div>

<script>

const PRAYERS = ["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];

const RECITERS = [
{ name:"Mishary Rashid", file:"mishary.mp3" },
{ name:"Saad Al Ghamdi", file:"saad.mp3" }
];

let prayerTimes = {};
let hijriDate = "";
let selectedReciter = localStorage.getItem("reciter") || RECITERS[0].file;

async function init(){
applyTheme();
populateReciters();
await loadPrayerData();
renderPrayers();
startScheduler();
updateCountdown();
}

function applyTheme(){
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
if(!prefersDark){
document.body.style.background =
"linear-gradient(-45deg,#e8f5e9,#c8e6c9,#a5d6a7,#81c784)";
}
}

async function loadPrayerData(){
try{
const today = new Date().toDateString();
if(localStorage.getItem("prayerDate")===today){
prayerTimes = JSON.parse(localStorage.getItem("prayerTimes"));
hijriDate = localStorage.getItem("hijriDate");
return;
}

const coords = await getCoords();
const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${coords.lat}&longitude=${coords.lon}&method=2`);
if(!res.ok) throw new Error("API fail");

const data = await res.json();
prayerTimes = data.data.timings;
hijriDate = data.data.date.hijri.date;

localStorage.setItem("prayerDate",today);
localStorage.setItem("prayerTimes",JSON.stringify(prayerTimes));
localStorage.setItem("hijriDate",hijriDate);

}catch{
prayerTimes={
Fajr:"05:00",
Sunrise:"06:30",
Dhuhr:"12:30",
Asr:"15:45",
Maghrib:"18:15",
Isha:"19:45"
};
hijriDate="Offline Mode";
}
}

function getCoords(){
return new Promise(resolve=>{
navigator.geolocation.getCurrentPosition(
pos=>resolve({lat:pos.coords.latitude,lon:pos.coords.longitude}),
()=>resolve({lat:40.7128,lon:-74.0060})
);
});
}

function renderPrayers(){
const container=document.getElementById("prayerContainer");
container.innerHTML=`<div style="margin-bottom:10px;color:#81c784;">Hijri: ${hijriDate}</div>`;

PRAYERS.forEach(name=>{
const time=prayerTimes[name];
if(!time) return;

container.innerHTML+=`
<div class="prayer" id="row_${name}">
<div>
<strong>${name}</strong><br>${time}
</div>
<input type="checkbox"
${localStorage.getItem("notify_"+name)==="true"?"checked":""}
onchange="toggleNotify('${name}',this.checked)">
</div>`;
});
highlightNext();
}

function highlightNext(){
const now=new Date();
for(let name of PRAYERS){
const [h,m]=prayerTimes[name].split(":").map(Number);
const t=new Date();
t.setHours(h,m,0,0);
if(t>now){
document.getElementById("row_"+name)?.classList.add("active");
break;
}
}
}

function updateCountdown(){
setInterval(()=>{
const now=new Date();
for(let name of PRAYERS){
const [h,m]=prayerTimes[name].split(":").map(Number);
const t=new Date();
t.setHours(h,m,0,0);
if(t>now){
const diff=t-now;
const hrs=Math.floor(diff/3600000);
const mins=Math.floor((diff%3600000)/60000);
const secs=Math.floor((diff%60000)/1000);
document.getElementById("countdown").innerText=
`Next: ${name} in ${hrs}h ${mins}m ${secs}s`;
break;
}
}
},1000);
}

function startScheduler(){
setInterval(()=>{
const now=new Date().toTimeString().slice(0,5);
PRAYERS.forEach(name=>{
if(localStorage.getItem("notify_"+name)==="true"){
if(prayerTimes[name]===now){
triggerAzan(name);
}
}
});
},1000);
}

function triggerAzan(name){
if(Notification.permission==="granted"){
new Notification(name+" Prayer Time");
}
new Audio(selectedReciter).play();
}

function toggleNotify(name,val){
localStorage.setItem("notify_"+name,val);
Notification.requestPermission();
}

function populateReciters(){
const select=document.getElementById("reciterSelect");
RECITERS.forEach(r=>{
const opt=document.createElement("option");
opt.value=r.file;
opt.text=r.name;
if(r.file===selectedReciter) opt.selected=true;
select.appendChild(opt);
});
select.onchange=e=>{
selectedReciter=e.target.value;
localStorage.setItem("reciter",selectedReciter);
};
}

function previewAzan(){
new Audio(selectedReciter).play();
}

function testAzan(){
triggerAzan("Test Prayer");
}

function openSettings(){
document.getElementById("settingsModal").style.display="flex";
}

function closeSettings(){
document.getElementById("settingsModal").style.display="none";
}

init();

</script>

</body>
</html>
