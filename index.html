<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Azan Unlimited</title>

<link rel="icon" href="favicon.ico">
<link rel="manifest" href="manifest.json">

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">

<style>
*{margin:0;padding:0;box-sizing:border-box}

body{
font-family:'Inter',sans-serif;
min-height:100vh;
color:white;
display:flex;
flex-direction:column;
align-items:center;
background:linear-gradient(-45deg,#0f1117,#1b2a1f,#16351f,#0e2d18);
background-size:400% 400%;
animation:gradient 15s ease infinite;
}

@keyframes gradient{
0%{background-position:0% 50%}
50%{background-position:100% 50%}
100%{background-position:0% 50%}
}

header{
padding:25px;
font-size:1.8rem;
font-weight:700;
}

#installBtn{
margin-bottom:10px;
padding:8px 16px;
border:none;
border-radius:8px;
background:#00c853;
color:black;
font-weight:600;
cursor:pointer;
display:none;
}

#countdown{
margin:15px 0;
font-size:1.1rem;
color:#81c784;
}

.prayer-container{
width:100%;
max-width:500px;
padding:10px;
}

.prayer{
display:flex;
justify-content:space-between;
align-items:center;
padding:18px;
margin:8px 0;
border-radius:16px;
background:rgba(255,255,255,0.08);
backdrop-filter:blur(10px);
transition:0.3s;
}

.prayer.active{
background:#00c853;
color:black;
box-shadow:0 0 25px #00c853;
}

.prayer-name{
font-weight:600;
}

.toggle{
cursor:pointer;
}

.settings-btn{
position:fixed;
top:20px;
right:20px;
cursor:pointer;
font-size:1.2rem;
}

.modal{
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,0.6);
display:none;
justify-content:center;
align-items:center;
}

.modal-content{
background:#121212;
padding:25px;
border-radius:15px;
width:90%;
max-width:400px;
}

select{
width:100%;
padding:8px;
margin-top:10px;
border-radius:8px;
border:none;
}

footer{
margin-top:auto;
padding:20px;
font-size:0.8rem;
color:#aaa;
}
</style>
</head>
<body>

<div class="settings-btn" onclick="openSettings()">⚙️</div>
<header>Azan Unlimited</header>
<button id="installBtn">Install App</button>
<div id="countdown">Loading...</div>

<div class="prayer-container" id="prayerContainer"></div>

<footer>© 2026 ZLT Co.</footer>

<div class="modal" id="settingsModal">
<div class="modal-content">
<h3>Settings</h3>
<label>Reciter</label>
<select id="reciterSelect"></select>
<br><br>
<button onclick="closeSettings()">Close</button>
</div>
</div>

<script>

<script>

/////////////////////////
// CONFIG
/////////////////////////

const PRAYERS = ["Fajr","Sunrise","Dhuhr","Asr","Maghrib","Isha"];

const RECITERS = [
{ name:"Mishary Rashid", file:"mishary.mp3" },
{ name:"Saad Al Ghamdi", file:"saad.mp3" },
];

let prayerTimes = {};
let hijriDate = "";
let selectedReciter = localStorage.getItem("reciter") || RECITERS[0].file;

/////////////////////////
// INIT
/////////////////////////

async function init(){
applyTheme();
populateReciters();
registerServiceWorker();
setupInstallButton();
await loadPrayerData();
renderPrayers();
startPreciseScheduler();
}

/////////////////////////
// THEME AUTO
/////////////////////////

function applyTheme(){
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
document.body.style.background = prefersDark
? "linear-gradient(-45deg,#0f1117,#1b2a1f,#16351f,#0e2d18)"
: "linear-gradient(-45deg,#e8f5e9,#c8e6c9,#a5d6a7,#81c784)";
}

/////////////////////////
// DAILY CACHE
/////////////////////////

async function loadPrayerData(){
const today = new Date().toDateString();
const cachedDate = localStorage.getItem("prayerDate");

if(cachedDate === today){
prayerTimes = JSON.parse(localStorage.getItem("prayerTimes"));
hijriDate = localStorage.getItem("hijriDate");
return;
}

const coords = await getCoords();
const res = await fetch(`https://api.aladhan.com/v1/timings?latitude=${coords.lat}&longitude=${coords.lon}&method=2`);
const data = await res.json();

prayerTimes = data.data.timings;
hijriDate = data.data.date.hijri.date;

localStorage.setItem("prayerDate",today);
localStorage.setItem("prayerTimes",JSON.stringify(prayerTimes));
localStorage.setItem("hijriDate",hijriDate);
}

function getCoords(){
return new Promise(resolve=>{
navigator.geolocation.getCurrentPosition(
pos=>resolve({lat:pos.coords.latitude,lon:pos.coords.longitude}),
()=>resolve({lat:40.7128,lon:-74.0060})
);
});
}

/////////////////////////
// RENDER
/////////////////////////

function renderPrayers(){
const container=document.getElementById("prayerContainer");
container.innerHTML = `<div style="margin-bottom:15px;color:#81c784;">Hijri: ${hijriDate}</div>`;

PRAYERS.forEach(name=>{
const time = prayerTimes[name];
if(!time) return;

const saved = localStorage.getItem("notify_"+name)==="true";

container.innerHTML+=`
<div class="prayer" id="row_${name}">
<div>
<div class="prayer-name">${name}</div>
<div>${time}</div>
</div>
<input type="checkbox"
${saved?"checked":""}
onchange="toggleNotify('${name}',this.checked)">
</div>
`;
});
}

/////////////////////////
// PRECISE SCHEDULER
/////////////////////////

function startPreciseScheduler(){
setInterval(()=>{
const now = new Date();
const currentTime = now.toTimeString().slice(0,8);

PRAYERS.forEach(name=>{
if(localStorage.getItem("notify_"+name)==="true"){
const prayerTime = prayerTimes[name]+":00";
if(prayerTime === currentTime){
triggerAzan(name);
}
}
});
},1000);
}

/////////////////////////
// AZAN
/////////////////////////

function triggerAzan(name){
if(Notification.permission==="granted"){
navigator.serviceWorker.getRegistration().then(reg=>{
reg.showNotification(name+" Prayer Time",{
body:"It's time for "+name,
icon:"favicon.ico",
vibrate:[200,100,200],
requireInteraction:true
});
});
}

new Audio(selectedReciter).play();
}

/////////////////////////
// TEST BUTTON
/////////////////////////

function testAzan(){
triggerAzan("Test Prayer");
}

/////////////////////////
// RECITER
/////////////////////////

function populateReciters(){
const select=document.getElementById("reciterSelect");

RECITERS.forEach(r=>{
const opt=document.createElement("option");
opt.value=r.file;
opt.text=r.name;
if(r.file===selectedReciter) opt.selected=true;
select.appendChild(opt);
});

select.onchange=e=>{
selectedReciter=e.target.value;
localStorage.setItem("reciter",selectedReciter);
};

const previewBtn=document.createElement("button");
previewBtn.innerText="Preview Azan";
previewBtn.onclick=()=>new Audio(selectedReciter).play();
select.parentNode.appendChild(previewBtn);
}

/////////////////////////
// NOTIFY TOGGLE
/////////////////////////

function toggleNotify(name,val){
localStorage.setItem("notify_"+name,val);
if(Notification.permission!=="granted"){
Notification.requestPermission();
}
}

/////////////////////////
// SERVICE WORKER
/////////////////////////

function registerServiceWorker(){
if("serviceWorker" in navigator){
navigator.serviceWorker.register("service-worker.js");
}
}

/////////////////////////
// INSTALL
/////////////////////////

let deferredPrompt;
function setupInstallButton(){
window.addEventListener("beforeinstallprompt",e=>{
e.preventDefault();
deferredPrompt=e;
const btn=document.getElementById("installBtn");
btn.style.display="block";
btn.onclick=()=>deferredPrompt.prompt();
});
}

/////////////////////////

init();

</script>

</body>
</html>
